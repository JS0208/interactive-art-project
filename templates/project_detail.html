{% extends "base.html" %}

{% block title %}{{ project.name }} - Interactive Art{% endblock %}

{% block content %}
<a href="/projects" class="btn btn-secondary mb-3">&larr; Back to Projects</a>
<h1>{{ project.name }}</h1>
<p class="lead">{{ project.description }}</p>

<div class="card mb-4">
    <div class="card-header">
        Interactive Art Display
    </div>
    <div class="card-body text-center">
        <img id="art-display" src="" alt="Interactive Art" class="img-fluid mb-3" style="max-width: 100%; height: auto; border: 1px solid #ddd;">
        <button id="generate-art-btn" class="btn btn-primary">Generate New Art</button>
        <div id="art-controls" class="mt-3">
            <!-- Placeholder for future interactive controls (sliders, color pickers, etc.) -->
            <p>Controls will go here.</p>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const generateBtn = document.getElementById('generate-art-btn');
        const artDisplay = document.getElementById('art-display');
        const projectId = "{{ project.id }}"; // Flask context to JS

        function generateArt() {
            // Show a loading indicator
            artDisplay.src = "/static/loading.gif"; // You'll need to add a loading GIF
            artDisplay.alt = "Loading...";

            fetch(`/generate_art/${projectId}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.blob(); // Get the response as a Blob (for image)
                })
                .then(blob => {
                    const imageUrl = URL.createObjectURL(blob);
                    artDisplay.src = imageUrl;
                    artDisplay.alt = "Interactive Art";
                })
                .catch(error => {
                    console.error('Error generating art:', error);
                    artDisplay.src = ""; // Clear image on error
                    artDisplay.alt = "Error loading art.";
                });
        }

        // Initial art generation when page loads
        generateArt();

        // Event listener for the button
        generateBtn.addEventListener('click', generateArt);
    });
</script>
{% endblock %}